<template>
  <component
    :is="animation"
    v-if="items.length"
    tag="ul"
    class="x-items-list"
    data-test="items-list"
  >
    <li
      v-for="item in computedItems"
      :key="item.id"
      class="x-items-list__item"
      :class="item.class"
      :data-test="item.dataTest"
    >
      <!--
        @slot Custom item to render.
          @binding {ListItem} item - Item data.
      -->
      <slot :item="item" :name="item.slotName">{{ item.id }}</slot>
    </li>
  </component>
</template>

<script lang="ts">
  import { computed, defineComponent, PropType } from 'vue';
  import { ListItem } from '../utils/types';
  import { toKebabCase } from '../utils/string';
  import { animationProp } from '../utils/options-api';

  /**
   * It renders a list of {@link ListItem} providing a slot for each `slotName` which depends on
   * the `modelName`of the item.
   *
   * @public
   */
  export default defineComponent({
    name: 'ItemsList',
    props: {
      /**
       * Animation component that will be used to animate the list.
       *
       * @public
       */
      animation: {
        type: animationProp,
        default: 'ul'
      },

      /**
       * List of items.
       *
       * @public
       */
      items: {
        type: Array as PropType<ListItem[]>,
        required: true
      },

      /**
       * Item's classes.
       *
       * @public
       */
      itemClass: {
        type: String
      }
    },
    setup(props) {
      /**
       * The list of the items with additional properties.
       *
       * @returns A list of items with `dataTest`, `class` and the `slotName` for each item.
       *
       * @internal
       */
      const computedItems = computed(
        (): {
          dataTest: string;
          class: Array<string | undefined>;
        }[] => {
          return props.items.map(item => {
            const modelName = toKebabCase(item.modelName);
            return {
              ...item,
              dataTest: `${modelName}s-list-item`,
              class: [`x-${modelName}s-list-item`, props.itemClass],
              slotName: modelName
            };
          });
        }
      );

      return { computedItems };
    }
  });
</script>
