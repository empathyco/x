const { addComponentDocFileToSidebar } = require('./runbooks-integraton');

/* eslint-disable @typescript-eslint/explicit-function-return-type */
/**
 * Replaces returns and tubes to make the input compatible with markdown.
 *
 * @param input - Input to be cleaned.
 * @returns String Cleaned markdown compatible string.
 *
 * @internal
 */
function cleanMarkdown(input) {
  return input.replace(/\r?\n/g, '<br />').replace(/\|/g, '\\|');
}

const COMPONENTS_DOC_FOLDER = 'API-reference/components';

/**
 * This function is used in the config of `docgen.config.js` to generate the destination of each
 * documentation file generated by docgen.
 *
 * @param {string} file - The file to process and return its destination.
 * @param {object} config - The docgen config.
 * @returns {string} - The full path of the doc file. It is a relative to `docs` folder and
 * includes de file name and extension.
 */
function getDocumentFileDestination(file, config) {
  const commonComponentsRegex = /^components\/(.*)\/(.*)\.vue$/;
  const xModulesRegex = /^x-modules\/(.+)\/components\/(.+)\.vue$/;

  const destinationFileName =
    generateDestination(`${COMPONENTS_DOC_FOLDER}/common`, commonComponentsRegex, file) ||
    generateDestination(`${COMPONENTS_DOC_FOLDER}`, xModulesRegex, file);

  if (destinationFileName) {
    return `${config.outDir}/${destinationFileName}`;
  } else {
    return '';
  }
}

/**
 * Function to generate the documentation file path, using a regex to extract the path and file
 * name.
 * @param folder {string} - The base folder of the path.
 * @param regex {RegExp} - The the regex to extract the path and file name.
 * @param file {string} - The full path of documentation file to extract the path and file name
 * from.
 * @returns {string} - The full path of the doc file. It is a relative to `docs` folder and
 * includes de file name and extension. If it doesn't match the regex, an empty string is returned.
 */
function generateDestination(folder, regex, file) {
  const match = regex.exec(file);
  if (match) {
    const [, path, componentName] = match;
    return `${folder}/${path}/x-components.${componentName}.md`;
  } else {
    return '';
  }
}

module.exports = {
  cleanMarkdown,
  getDocumentFileDestination,
  COMPONENTS_DOC_FOLDER
};
